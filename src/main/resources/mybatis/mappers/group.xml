<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="group">

	<resultMap id="GroupVo" type="com.lunchwb.vo.GroupVo">
		<result column="group_no" property="groupNo" />
		<result column="group_leader" property="groupLeader" />
		<result column="group_name" property="groupName" />
		<result column="group_member_no" property="groupMemberNo" />
		<result column="leader_check" property="leaderCheck" />
		<result column="boss_check" property="bossCheck" />
		<result column="member_name" property="memberName" />
		<result column="member_sex" property="member_Sex" />
		<result column="member_age" property="memberAge" />
	</resultMap>	


	<!-- 그룹 리스트 -->
	<select id="userGroups" parameterType="int" resultMap="GroupVo">
		SELECT  g.group_no
				g.group_name
		FROM groups g, group_member m
		WHERE g.group_no = m.gorup_no
		AND user_no = #{groupNo}
		ORDER BY group_member_no ASC;
	</select>


	<!-- 그룹 멤버 리스트 -->
	<select id="groupMembers" parameterType="int" resultMap="GroupVo">
		SELECT  group_member_no,
				user_no,
				group_no,
				leader_check,
				boss_check,
				member_name,
				member_sex,
				member_age
		FROM group_member
		WHERE group_no = #{groupNo}
		ORDER BY boss_check DESC,
				 group_member_no ASC
	</select>


	<!-- 그룹 생성 -->
	<insert id="createGroup" parameterType="com.lunchwb.vo.GroupVo">
		<selectKey keyProperty="groupNo" resultType="int" order="BEFORE">
			SELECT SEQ_GROUP_NO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO GROUPS
		VALUES (#{groupNo}, #{groupLeader}, #{groupName})
	</insert>
	
	
	<!-- 그룹원 추가 : user일 경우-->
	<insert id="addMember" parameterType="com.lunchwb.vo.GroupVo">
		INSERT INTO GROUP_MEMBER
		VALUES (SEQ_GROUP_MEMBER_NO.NEXTVAL, #{userNo}, #{groupNo}, #{leaderCheck}, 
				#{bossCheck}, #{memberName}, #{memberSex}, #{memberAge})
	</insert>

</mapper>